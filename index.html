<!doctype html>
<html>

<head>
  <title>skybox</title>
</head>

<body>
<script type=module>
import * as THREE from './three.module.js';
import {OrbitControls} from './OrbitControls.js';

(async () => {

const renderer = new THREE.WebGLRenderer({
  antialias: true,
  alpha: true,
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.sortObjects = false;
renderer.physicallyCorrectLights = true;
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);
renderer.domElement.style.backgroundColor = '#000';
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 1, 10);

const orbitControls = new OrbitControls(camera, renderer.domElement);
orbitControls.screenSpacePanning = true;
orbitControls.enableMiddleZoom = false;
// orbitControls.update();
orbitControls.target.set(0, 1, 0);

const ambientLight = new THREE.AmbientLight(0xFFFFFF);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xFFFFFF, 3);
directionalLight.position.set(10, 10, 10)
scene.add(directionalLight);
const directionalLight2 = new THREE.DirectionalLight(0xFFFFFF, 3);
scene.add(directionalLight2);

const skyboxGeometry = new THREE.SphereBufferGeometry( 500, 32, 32 )
  .applyMatrix4(new THREE.Matrix4().makeScale(-1, -1, -1));
const skyboxMaterial = new THREE.MeshBasicMaterial({
  color: 0xFF00FF,
});
const skyboxMesh = new THREE.Mesh(skyboxGeometry, skyboxMaterial);
skyboxMesh.frustumCulled = false;
scene.add(skyboxMesh);

function animate() {
  orbitControls.update();

  renderer.render(scene, camera);
}
renderer.setAnimationLoop(animate);

navigator.xr.addEventListener('sessiongranted', e => {
  let currentSession = null;
  function onSessionStarted(session) {
    session.addEventListener('end', onSessionEnded);

    renderer.xr.setSession(session);

    currentSession = session;
  }
  function onSessionEnded() {
    currentSession.removeEventListener('end', onSessionEnded);

    currentSession = null;
  }
  navigator.xr && navigator.xr.requestSession('immersive-vr', {
    optionalFeatures: [
      'local-floor',
      'bounded-floor',
    ],
  }).then(onSessionStarted);
});

})();

</script>
</body>

</html>
